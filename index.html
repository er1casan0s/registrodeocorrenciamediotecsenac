<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Registro - SENAC RN</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        /* Estilos baseados nas cores do SENAC RN */
        :root {
            --laranja: #FF6B00;
            --azul-marinho: #003366;
            --branco: #FFFFFF;
            --cinza-claro: #F5F5F5;
            --verde: #28a745;
            --amarelo: #ffc107;
            --vermelho: #dc3545;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--cinza-claro);
            color: var(--azul-marinho);
            line-height: 1.6;
        }
        
        /* Cabeçalho */
        header {
            background-color: var(--azul-marinho);
            color: var(--branco);
            padding: 1rem 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
        }
        
        .logo h1 {
            font-size: 1.5rem;
            margin-left: 10px;
        }
        
        /* Navegação */
        nav ul {
            display: flex;
            list-style: none;
        }
        
        nav ul li {
            margin-left: 1.5rem;
        }
        
        nav ul li a {
            color: var(--branco);
            text-decoration: none;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        
        nav ul li a:hover, 
        nav ul li a.active {
            background-color: var(--laranja);
        }
        
        /* Seções */
        section {
            display: none;
            background-color: var(--branco);
            padding: 2rem;
            margin: 2rem 0;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        section.active {
            display: block;
        }
        
        h2 {
            color: var(--azul-marinho);
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--laranja);
        }
        
        h3 {
            color: var(--azul-marinho);
            margin: 1.5rem 0 1rem;
        }
        
        /* Formulários */
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        /* Estilo para campos inválidos */
        input:invalid {
            border-color: var(--vermelho);
            box-shadow: 0 0 5px rgba(220, 53, 69, 0.3);
        }
        
        input:valid {
            border-color: var(--verde);
        }
        
        .input-hint {
            font-size: 0.85rem;
            color: #666;
            margin-top: 0.25rem;
            display: block;
        }
        
        .input-error {
            font-size: 0.85rem;
            color: var(--vermelho);
            margin-top: 0.25rem;
            display: none;
        }
        
        button {
            background-color: var(--laranja);
            color: var(--branco);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        
        button:hover {
            background-color: #e05e00;
        }
        
        .btn-secondary {
            background-color: var(--azul-marinho);
        }
        
        .btn-secondary:hover {
            background-color: #002244;
        }
        
        .btn-danger {
            background-color: var(--vermelho);
        }
        
        .btn-danger:hover {
            background-color: #c82333;
        }
        
        .btn-success {
            background-color: var(--verde);
        }
        
        .btn-success:hover {
            background-color: #218838;
        }
        
        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }
        
        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }
        
        /* Tabelas */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        th {
            background-color: var(--azul-marinho);
            color: var(--branco);
        }
        
        tr:nth-child(even) {
            background-color: var(--cinza-claro);
        }
        
        /* Mensagens de confirmação */
        .message {
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
            display: none;
        }
        
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        /* Abas de turno */
        .turno-tabs {
            display: flex;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid #ddd;
        }
        
        .turno-tab {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 4px 4px 0 0;
            margin-right: 0.5rem;
        }
        
        .turno-tab.active {
            background-color: var(--azul-marinho);
            color: var(--branco);
            border-color: var(--azul-marinho);
        }
        
        .turno-content {
            display: none;
        }
        
        .turno-content.active {
            display: block;
        }
        
        /* Grid de turmas */
        .turmas-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1rem;
        }
        
        .turma-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 1.5rem;
            background-color: var(--branco);
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .turma-card h4 {
            color: var(--azul-marinho);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #ddd;
            padding-right: 40px;
        }
        
        .turma-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #ddd;
        }
        
        .turma-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        /* Modal de edição */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background-color: var(--branco);
            padding: 2rem;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #ddd;
        }
        
        .modal-header h3 {
            margin: 0;
            color: var(--azul-marinho);
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--azul-marinho);
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        
        /* Estilos para Relatórios */
        .filtro-relatorio {
            margin-bottom: 1rem;
            padding: 1rem;
            background-color: var(--cinza-claro);
            border-radius: 4px;
            border-left: 4px solid var(--azul-marinho);
        }

        .relatorio-aluno {
            margin-bottom: 2rem;
        }

        .relatorio-aluno h4 {
            color: var(--azul-marinho);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--laranja);
        }

        .ocorrencias-lista {
            margin-left: 1rem;
        }

        .ocorrencia-item {
            background-color: var(--branco);
            padding: 1rem;
            margin-bottom: 0.5rem;
            border-radius: 4px;
            border-left: 4px solid var(--laranja);
        }

        .ocorrencia-tipo {
            font-weight: bold;
            color: var(--azul-marinho);
        }

        .ocorrencia-data {
            color: #666;
            font-size: 0.9rem;
        }

        .ocorrencia-detalhes {
            margin-top: 0.5rem;
        }

        .sem-ocorrencias {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 2rem;
        }

        .relatorio-turma {
            margin-bottom: 2rem;
        }

        .relatorio-turma h4 {
            color: var(--azul-marinho);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--laranja);
        }
        
        /* Rodapé */
        footer {
            background-color: var(--azul-marinho);
            color: var(--branco);
            text-align: center;
            padding: 1.5rem 0;
            margin-top: 2rem;
        }

        /* Responsividade - Adicione estas regras no final do CSS existente */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
                padding: 0.5rem 0;
            }
            
            .logo h1 {
                font-size: 1.2rem;
                margin: 0.5rem 0;
            }
            
            nav ul {
                margin-top: 0.5rem;
                flex-wrap: wrap;
                justify-content: center;
                gap: 0.25rem;
            }
            
            nav ul li {
                margin: 0.25rem;
            }
            
            nav ul li a {
                padding: 0.4rem 0.8rem;
                font-size: 0.9rem;
            }
            
            .container {
                width: 95%;
                padding: 0 0.5rem;
            }
            
            section {
                padding: 1rem;
                margin: 1rem 0;
            }
            
            h2 {
                font-size: 1.3rem;
                margin-bottom: 1rem;
            }
            
            h3 {
                font-size: 1.1rem;
                margin: 1rem 0 0.5rem;
            }
            
            .form-group {
                margin-bottom: 1rem;
            }
            
            input, select, textarea {
                padding: 0.6rem;
                font-size: 0.9rem;
            }
            
            button {
                padding: 0.6rem 1.2rem;
                font-size: 0.9rem;
                width: 100%;
            }
            
            .btn-small {
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 0.25rem;
            }
            
            .turmas-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .turma-card {
                padding: 1rem;
            }
            
            table {
                font-size: 0.8rem;
            }
            
            th, td {
                padding: 0.4rem;
                word-break: break-word;
            }
            
            /* Melhorias para tabelas em mobile */
            .turma-card table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }
            
            .turno-tabs {
                flex-wrap: wrap;
                gap: 0.25rem;
            }
            
            .turno-tab {
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
                margin-right: 0.25rem;
                flex: 1;
                min-width: 120px;
                text-align: center;
            }
            
            .modal-content {
                width: 95%;
                padding: 1rem;
                margin: 1rem;
            }
            
            .modal-header h3 {
                font-size: 1.1rem;
            }
            
            .modal-footer {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .modal-footer button {
                width: 100%;
            }
            
            .turma-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
            
            .turma-actions {
                width: 100%;
                justify-content: flex-end;
            }

            /* Responsividade para relatórios */
            .ocorrencia-item {
                padding: 0.75rem;
            }
            
            .relatorio-aluno h4,
            .relatorio-turma h4 {
                font-size: 1.1rem;
            }
            
            /* Ajustes específicos para telas muito pequenas */
            @media (max-width: 480px) {
                .logo h1 {
                    font-size: 1rem;
                }
                
                nav ul {
                    flex-direction: column;
                    width: 100%;
                }
                
                nav ul li {
                    margin: 0.1rem 0;
                    width: 100%;
                }
                
                nav ul li a {
                    display: block;
                    text-align: center;
                    padding: 0.5rem;
                }
                
                section {
                    padding: 0.75rem;
                    margin: 0.5rem 0;
                }
                
                .turma-card {
                    padding: 0.75rem;
                }
                
                th, td {
                    padding: 0.3rem;
                    font-size: 0.75rem;
                }
                
                /* Ocultar colunas menos importantes em telas muito pequenas */
                .turma-card td:nth-child(2),
                .turma-card th:nth-child(2) {
                    display: none;
                }
                
                .action-buttons {
                    flex-direction: row;
                    justify-content: center;
                }
            }
            
            /* Ajustes para orientação landscape */
            @media (max-height: 500px) and (orientation: landscape) {
                header {
                    padding: 0.5rem 0;
                }
                
                .container {
                    margin: 0.5rem auto;
                }
                
                section {
                    padding: 0.75rem;
                    margin: 0.5rem 0;
                }
                
                .modal-content {
                    max-height: 90vh;
                    overflow-y: auto;
                }
            }
        }

        /* Melhorias adicionais para tablets */
        @media (min-width: 769px) and (max-width: 1024px) {
            .turmas-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .container {
                width: 92%;
            }
        }

        /* Garantir que inputs tenham tamanho de fonte adequado no iOS */
        @media (max-width: 768px) {
            input, select, textarea {
                font-size: 16px; /* Previne zoom no iOS */
            }
        }

        /* Melhorar a experiência touch */
        @media (max-width: 768px) {
            button, .nav-link, .turno-tab {
                min-height: 44px; /* Tamanho mínimo para touch */
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .action-buttons button {
                min-height: 36px;
            }
        }

        /* Ajustes para o formulário de nova turma em mobile */
        @media (max-width: 768px) {
            #btn-nova-turma {
                margin-top: 0.5rem;
                width: 100%;
            }
        }

        /* Melhorar a legibilidade em telas pequenas */
        @media (max-width: 768px) {
            body {
                font-size: 14px;
                line-height: 1.4;
            }
            
            .input-hint, .input-error {
                font-size: 0.75rem;
            }
        }

        /* Ajustes para datalist em mobile */
        @media (max-width: 768px) {
            input[list] {
                font-size: 16px; /* Previne zoom */
            }
        }
    </style>
</head>
<body>
    <!-- Cabeçalho com navegação -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <h1>Sistema de Registro - SENAC RN</h1>
                </div>
                <nav>
                    <ul>
                        <li><a href="#" class="nav-link active" data-target="cadastro">Cadastrar</a></li>
                        <li><a href="#" class="nav-link" data-target="atrasos">Atrasos</a></li>
                        <li><a href="#" class="nav-link" data-target="celular">Celular</a></li>
                        <li><a href="#" class="nav-link" data-target="comportamento">Comportamento</a></li>
                        <li><a href="#" class="nav-link" data-target="alunos">Alunos</a></li>
                        <li><a href="#" class="nav-link" data-target="relatorios">Relatórios</a></li>
                        <li><a href="#" class="nav-link" data-target="relatorios-avancados">Relatórios Avançados</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <div class="container">
        <!-- Mensagens de confirmação -->
        <div id="message" class="message"></div>

        <!-- Seção de Cadastro de Aluno -->
        <section id="cadastro" class="active">
            <h2>Cadastrar Novo Aluno</h2>
            <form id="form-cadastro">
                <div class="form-group">
                    <label for="nome-aluno">Nome do Aluno:</label>
                    <input type="text" id="nome-aluno" required>
                </div>
                <div class="form-group">
                    <label for="turno">Turno:</label>
                    <select id="turno" required>
                        <option value="">Selecione o turno</option>
                        <option value="matutino">Matutino</option>
                        <option value="vespertino">Vespertino</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="turma">Turma:</label>
                    <select id="turma" required>
                        <option value="">Primeiro selecione o turno</option>
                    </select>
                    <div style="margin-top: 0.5rem;">
                        <button type="button" id="btn-nova-turma" class="btn-secondary btn-small">+ Adicionar Nova Turma</button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="contato-responsavel">Contato do Responsável:</label>
                    <input type="text" id="contato-responsavel" 
                           placeholder="(84) 99999-9999"
                           maxlength="15"
                           required>
                    <span class="input-hint">Formato: (DDD) 9XXXX-XXXX</span>
                    <span class="input-error" id="contato-error">Por favor, digite um telefone válido no formato (DDD) 9XXXX-XXXX</span>
                </div>
                <button type="submit">Cadastrar Aluno</button>
            </form>
        </section>

        <!-- Seção de Registro de Atrasos -->
        <section id="atrasos">
            <h2>Registrar Atrasos</h2>
            <form id="form-atrasos">
                <div class="form-group">
                    <label for="aluno-atraso">Aluno:</label>
                    <input type="text" id="aluno-atraso" list="alunos-atraso" required>
                    <datalist id="alunos-atraso">
                        <!-- Opções serão preenchidas via JavaScript -->
                    </datalist>
                </div>
                <div class="form-group">
                    <label for="hora-atraso">Hora do Atraso:</label>
                    <input type="time" id="hora-atraso" required>
                </div>
                <div class="form-group">
                    <label for="data-atraso">Data do Atraso:</label>
                    <input type="date" id="data-atraso" required>
                </div>
                <button type="submit">Registrar Atraso</button>
            </form>
        </section>

        <!-- Seção de Registro de Uso de Celular -->
        <section id="celular">
            <h2>Registrar Uso de Celular</h2>
            <form id="form-celular">
                <div class="form-group">
                    <label for="aluno-celular">Aluno:</label>
                    <input type="text" id="aluno-celular" list="alunos-celular" required>
                    <datalist id="alunos-celular">
                        <!-- Opções serão preenchidas via JavaScript -->
                    </datalist>
                </div>
                <div class="form-group">
                    <label for="aula-celular">Aula em que ocorreu:</label>
                    <input type="text" id="aula-celular" required>
                </div>
                <div class="form-group">
                    <label for="observacao-celular">Observação:</label>
                    <textarea id="observacao-celular"></textarea>
                </div>
                <button type="submit">Registrar Uso de Celular</button>
            </form>
        </section>

        <!-- Seção de Registro de Comportamento -->
        <section id="comportamento">
            <h2>Registrar Observação de Comportamento</h2>
            <form id="form-comportamento">
                <div class="form-group">
                    <label for="aluno-comportamento">Aluno:</label>
                    <input type="text" id="aluno-comportamento" list="alunos-comportamento" required>
                    <datalist id="alunos-comportamento">
                        <!-- Opções serão preenchidas via JavaScript -->
                    </datalist>
                </div>
                <div class="form-group">
                    <label for="observacao-comportamento">Observação:</label>
                    <textarea id="observacao-comportamento" required></textarea>
                </div>
                <button type="submit">Registrar Observação</button>
            </form>
        </section>

        <!-- Seção de Alunos Cadastrados -->
        <section id="alunos">
            <h2>Alunos Cadastrados</h2>
            
            <!-- Abas de turno -->
            <div class="turno-tabs">
                <div class="turno-tab active" data-turno="matutino">Turno Matutino</div>
                <div class="turno-tab" data-turno="vespertino">Turno Vespertino</div>
            </div>
            
            <!-- Conteúdo do turno matutino -->
            <div id="turno-matutino" class="turno-content active">
                <h3>Turmas do Turno Matutino</h3>
                <div class="turmas-grid" id="grid-matutino">
                    <!-- Turmas serão inseridas dinamicamente via JavaScript -->
                </div>
            </div>
            
            <!-- Conteúdo do turno vespertino -->
            <div id="turno-vespertino" class="turno-content">
                <h3>Turmas do Turno Vespertino</h3>
                <div class="turmas-grid" id="grid-vespertino">
                    <!-- Turmas serão inseridas dinamicamente via JavaScript -->
                </div>
            </div>
        </section>

        <!-- Seção de Relatórios -->
        <section id="relatorios">
            <h2>Relatórios</h2>
            <div class="form-group">
                <label for="filtro-turma">Filtrar por Turma:</label>
                <select id="filtro-turma">
                    <option value="">Todas as turmas</option>
                    <!-- Opções serão preenchidas via JavaScript -->
                </select>
            </div>
            <div class="form-group">
                <button id="btn-gerar-relatorio">Gerar Relatório</button>
            </div>
            
            <div id="relatorio-alunos">
                <h3>Alunos Cadastrados</h3>
                <table id="tabela-alunos">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Turma</th>
                            <th>Contato do Responsável</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Dados dos alunos serão inseridos aqui via JavaScript -->
                    </tbody>
                </table>
            </div>
            
            <div id="relatorio-atrasos">
                <h3>Atrasos Registrados</h3>
                <table id="tabela-atrasos">
                    <thead>
                        <tr>
                            <th>Aluno</th>
                            <th>Turma</th>
                            <th>Data</th>
                            <th>Hora</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Dados dos atrasos serão inseridos aqui via JavaScript -->
                    </tbody>
                </table>
            </div>
            
            <div id="relatorio-celular">
                <h3>Uso de Celular Registrado</h3>
                <table id="tabela-celular">
                    <thead>
                        <tr>
                            <th>Aluno</th>
                            <th>Turma</th>
                            <th>Aula</th>
                            <th>Observação</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Dados do uso de celular serão inseridos aqui via JavaScript -->
                    </tbody>
                </table>
            </div>
            
            <div id="relatorio-comportamento">
                <h3>Observações de Comportamento</h3>
                <table id="tabela-comportamento">
                    <thead>
                        <tr>
                            <th>Aluno</th>
                            <th>Turma</th>
                            <th>Observação</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Dados de comportamento serão inseridos aqui via JavaScript -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Seção de Relatórios Avançados -->
        <section id="relatorios-avancados">
            <h2>Relatórios Avançados</h2>
            
            <div class="form-group">
                <label for="tipo-relatorio">Tipo de Relatório:</label>
                <select id="tipo-relatorio" required>
                    <option value="">Selecione o tipo</option>
                    <option value="aluno">Por Aluno</option>
                    <option value="turma">Por Turma</option>
                    <option value="turno">Por Turno</option>
                </select>
            </div>

            <!-- Filtro por Aluno -->
            <div id="filtro-aluno" class="filtro-relatorio" style="display: none;">
                <div class="form-group">
                    <label for="aluno-relatorio">Aluno:</label>
                    <input type="text" id="aluno-relatorio" list="alunos-relatorio" required>
                    <datalist id="alunos-relatorio">
                        <!-- Opções serão preenchidas via JavaScript -->
                    </datalist>
                </div>
            </div>

            <!-- Filtro por Turma -->
            <div id="filtro-turma-relatorio" class="filtro-relatorio" style="display: none;">
                <div class="form-group">
                    <label for="turma-relatorio">Turma:</label>
                    <select id="turma-relatorio">
                        <option value="">Todas as turmas</option>
                    </select>
                </div>
            </div>

            <!-- Filtro por Turno -->
            <div id="filtro-turno" class="filtro-relatorio" style="display: none;">
                <div class="form-group">
                    <label for="turno-relatorio">Turno:</label>
                    <select id="turno-relatorio">
                        <option value="">Todos os turnos</option>
                        <option value="matutino">Matutino</option>
                        <option value="vespertino">Vespertino</option>
                    </select>
                </div>
            </div>

            <!-- Filtro por Período -->
            <div class="form-group">
                <label for="periodo-relatorio">Período:</label>
                <select id="periodo-relatorio">
                    <option value="todos">Todo o período</option>
                    <option value="personalizado">Personalizado</option>
                </select>
            </div>

            <!-- Período Personalizado -->
            <div id="periodo-personalizado" style="display: none;">
                <div class="form-group">
                    <label for="data-inicio">Data Início:</label>
                    <input type="date" id="data-inicio">
                </div>
                <div class="form-group">
                    <label for="data-fim">Data Fim:</label>
                    <input type="date" id="data-fim">
                </div>
            </div>

            <button id="btn-gerar-relatorio-completo" class="btn-success">Gerar Relatório</button>
            <button id="btn-download-relatorio" class="btn-secondary" style="display: none;">Download PDF</button>

            <!-- Resultado do Relatório -->
            <div id="resultado-relatorio" style="margin-top: 2rem; display: none;">
                <h3>Resultado do Relatório</h3>
                <div id="conteudo-relatorio">
                    <!-- Conteúdo do relatório será inserido aqui -->
                </div>
            </div>
        </section>
    </div>

    <!-- Modal de Edição de Aluno -->
    <div id="modal-editar" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Editar Aluno</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="form-editar-aluno">
                <input type="hidden" id="editar-id">
                <div class="form-group">
                    <label for="editar-nome">Nome do Aluno:</label>
                    <input type="text" id="editar-nome" required>
                </div>
                <div class="form-group">
                    <label for="editar-turno">Turno:</label>
                    <select id="editar-turno" required>
                        <option value="">Selecione o turno</option>
                        <option value="matutino">Matutino</option>
                        <option value="vespertino">Vespertino</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editar-turma">Turma:</label>
                    <select id="editar-turma" required>
                        <option value="">Primeiro selecione o turno</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editar-contato">Contato do Responsável:</label>
                    <input type="text" id="editar-contato" 
                           placeholder="(84) 99999-9999"
                           maxlength="15"
                           required>
                    <span class="input-hint">Formato: (DDD) 9XXXX-XXXX</span>
                    <span class="input-error" id="editar-contato-error">Por favor, digite um telefone válido no formato (DDD) 9XXXX-XXXX</span>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" id="btn-cancelar-edicao">Cancelar</button>
                    <button type="submit" class="btn-success">Salvar Alterações</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para Nova Turma -->
    <div id="modal-nova-turma" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Adicionar Nova Turma</h3>
                <button class="close-modal">&times;</button>
            </div>
            <form id="form-nova-turma">
                <div class="form-group">
                    <label for="nova-turma-turno">Turno:</label>
                    <select id="nova-turma-turno" required>
                        <option value="">Selecione o turno</option>
                        <option value="matutino">Matutino</option>
                        <option value="vespertino">Vespertino</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="nova-turma-serie">Série:</label>
                    <select id="nova-turma-serie" required>
                        <option value="">Selecione a série</option>
                        <option value="1">1ª Série</option>
                        <option value="2">2ª Série</option>
                        <option value="3">3ª Série</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="nova-turma-letra">Letra da Turma:</label>
                    <select id="nova-turma-letra" required>
                        <option value="">Selecione a letra</option>
                        <option value="A">A</option>
                        <option value="B">B</option>
                        <option value="C">C</option>
                        <option value="D">D</option>
                    </select>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" id="btn-cancelar-turma">Cancelar</button>
                    <button type="submit" class="btn-success">Adicionar Turma</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Confirmação de Exclusão de Turma -->
    <div id="modal-excluir-turma" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Excluir Turma</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="form-group">
                <p id="mensagem-exclusao-turma">Tem certeza que deseja excluir esta turma?</p>
                <p class="input-hint" id="alunos-afetados">Esta ação não pode ser desfeita.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" id="btn-cancelar-exclusao-turma">Cancelar</button>
                <button type="button" class="btn-danger" id="btn-confirmar-exclusao-turma">Excluir Turma</button>
            </div>
        </div>
    </div>

    <!-- Rodapé -->
    <footer>
        <div class="container">
            <p>Sistema de Registro Escolar - SENAC RN &copy; 2025</p>
        </div>
    </footer>

    <script>
        // Armazenamento de dados (simulando um banco de dados)
        let alunos = JSON.parse(localStorage.getItem('alunos')) || [];
        let atrasos = JSON.parse(localStorage.getItem('atrasos')) || [];
        let usoCelular = JSON.parse(localStorage.getItem('usoCelular')) || [];
        let comportamentos = JSON.parse(localStorage.getItem('comportamentos')) || [];

        // Mapeamento de turnos para turmas (dinâmico)
        let turnoTurmas = JSON.parse(localStorage.getItem('turnoTurmas')) || {
            matutino: ['1A', '2A', '3A'],
            vespertino: ['1B', '2B', '3B']
        };

        // Elementos DOM
        const messageEl = document.getElementById('message');
        const navLinks = document.querySelectorAll('.nav-link');
        const sections = document.querySelectorAll('section');
        
        // Formulários
        const formCadastro = document.getElementById('form-cadastro');
        const formAtrasos = document.getElementById('form-atrasos');
        const formCelular = document.getElementById('form-celular');
        const formComportamento = document.getElementById('form-comportamento');
        
        // Elementos do formulário de cadastro
        const turnoSelect = document.getElementById('turno');
        const turmaSelect = document.getElementById('turma');
        const contatoInput = document.getElementById('contato-responsavel');
        const contatoError = document.getElementById('contato-error');
        
        // Datalists para autocompletar
        const alunosAtrasoDatalist = document.getElementById('alunos-atraso');
        const alunosCelularDatalist = document.getElementById('alunos-celular');
        const alunosComportamentoDatalist = document.getElementById('alunos-comportamento');
        
        // Botão de gerar relatório
        const btnGerarRelatorio = document.getElementById('btn-gerar-relatorio');
        const filtroTurma = document.getElementById('filtro-turma');
        
        // Abas de turno
        const turnoTabs = document.querySelectorAll('.turno-tab');
        const turnoContents = document.querySelectorAll('.turno-content');
        
        // Modal de edição
        const modalEditar = document.getElementById('modal-editar');
        const formEditarAluno = document.getElementById('form-editar-aluno');
        const btnCancelarEdicao = document.getElementById('btn-cancelar-edicao');
        const closeModal = document.querySelector('.close-modal');
        const editarContatoInput = document.getElementById('editar-contato');
        const editarContatoError = document.getElementById('editar-contato-error');

        // Modal de nova turma
        const modalNovaTurma = document.getElementById('modal-nova-turma');
        const formNovaTurma = document.getElementById('form-nova-turma');
        const btnNovaTurma = document.getElementById('btn-nova-turma');
        const btnCancelarTurma = document.getElementById('btn-cancelar-turma');

        // Modal de exclusão de turma
        const modalExcluirTurma = document.getElementById('modal-excluir-turma');
        const btnCancelarExclusaoTurma = document.getElementById('btn-cancelar-exclusao-turma');
        const btnConfirmarExclusaoTurma = document.getElementById('btn-confirmar-exclusao-turma');
        const mensagemExclusaoTurma = document.getElementById('mensagem-exclusao-turma');
        const alunosAfetados = document.getElementById('alunos-afetados');

        // Elementos do relatório avançado
        const tipoRelatorioSelect = document.getElementById('tipo-relatorio');
        const filtroAlunoDiv = document.getElementById('filtro-aluno');
        const filtroTurmaRelatorioDiv = document.getElementById('filtro-turma-relatorio');
        const filtroTurnoDiv = document.getElementById('filtro-turno');
        const alunoRelatorioInput = document.getElementById('aluno-relatorio');
        const turmaRelatorioSelect = document.getElementById('turma-relatorio');
        const turnoRelatorioSelect = document.getElementById('turno-relatorio');
        const periodoRelatorioSelect = document.getElementById('periodo-relatorio');
        const periodoPersonalizadoDiv = document.getElementById('periodo-personalizado');
        const dataInicioInput = document.getElementById('data-inicio');
        const dataFimInput = document.getElementById('data-fim');
        const btnGerarRelatorioCompleto = document.getElementById('btn-gerar-relatorio-completo');
        const btnDownloadRelatorio = document.getElementById('btn-download-relatorio');
        const resultadoRelatorioDiv = document.getElementById('resultado-relatorio');
        const conteudoRelatorioDiv = document.getElementById('conteudo-relatorio');

        // Variáveis para controle de exclusão
        let turmaParaExcluir = null;
        let turnoParaExcluir = null;

        // Função para aplicar máscara de telefone
        function mascaraTelefone(telefone) {
            // Remove tudo que não é número
            const apenasNumeros = telefone.replace(/\D/g, '');
            
            // Aplica a máscara (XX) XXXXX-XXXX
            if (apenasNumeros.length <= 2) {
                return `(${apenasNumeros}`;
            } else if (apenasNumeros.length <= 7) {
                return `(${apenasNumeros.slice(0, 2)}) ${apenasNumeros.slice(2)}`;
            } else {
                return `(${apenasNumeros.slice(0, 2)}) ${apenasNumeros.slice(2, 7)}-${apenasNumeros.slice(7, 11)}`;
            }
        }

        // Função para validar telefone
        function validarTelefone(telefone) {
            // Remove tudo que não é número e verifica se tem 11 dígitos
            const apenasNumeros = telefone.replace(/\D/g, '');
            return apenasNumeros.length === 11;
        }

        // Função para formatar telefone para salvar (apenas números)
        function formatarTelefoneParaSalvar(telefone) {
            return telefone.replace(/\D/g, '');
        }

        // Função para formatar telefone para exibir
        function formatarTelefoneParaExibir(telefone) {
            const apenasNumeros = telefone.replace(/\D/g, '');
            if (apenasNumeros.length === 11) {
                return `(${apenasNumeros.slice(0, 2)}) ${apenasNumeros.slice(2, 7)}-${apenasNumeros.slice(7)}`;
            }
            return telefone;
        }

        // Função para salvar turmas no localStorage
        function salvarTurmasNoLocalStorage() {
            localStorage.setItem('turnoTurmas', JSON.stringify(turnoTurmas));
        }

        // Função para mostrar mensagens
        function showMessage(text, type) {
            messageEl.textContent = text;
            messageEl.className = `message ${type}`;
            messageEl.style.display = 'block';
            
            setTimeout(() => {
                messageEl.style.display = 'none';
            }, 5000);
        }

        // Função para navegar entre as seções
        function navigateToSection(targetId) {
            sections.forEach(section => {
                section.classList.remove('active');
            });
            
            navLinks.forEach(link => {
                link.classList.remove('active');
            });
            
            document.getElementById(targetId).classList.add('active');
            
            // Atualizar o link ativo na navegação
            document.querySelector(`[data-target="${targetId}"]`).classList.add('active');
            
            // Se for a seção de alunos ou relatórios, atualizar os dados
            if (targetId === 'alunos') {
                updateAlunosCadastrados();
            } else if (targetId === 'relatorios') {
                updateRelatorios();
            } else if (targetId === 'relatorios-avancados') {
                popularDadosRelatorio();
            }
        }

        // Função para popular o select de turmas baseado no turno selecionado
        function updateTurmaOptions() {
            const turno = turnoSelect.value;
            turmaSelect.innerHTML = '<option value="">Selecione a turma</option>';
            
            if (turno && turnoTurmas[turno]) {
                // Ordenar as turmas (1A, 1B, 2A, 2B, etc.)
                const turmasOrdenadas = turnoTurmas[turno].sort((a, b) => {
                    return a.localeCompare(b, undefined, { numeric: true });
                });
                
                turmasOrdenadas.forEach(turma => {
                    const option = document.createElement('option');
                    option.value = turma;
                    option.textContent = `${turma.charAt(0)}ª Série ${turma.charAt(1)}`;
                    turmaSelect.appendChild(option);
                });
            }
        }

        // Função para popular o select de turmas no modal de edição
        function updateTurmaOptionsEdicao() {
            const turno = document.getElementById('editar-turno').value;
            const turmaSelectEdicao = document.getElementById('editar-turma');
            turmaSelectEdicao.innerHTML = '<option value="">Selecione a turma</option>';
            
            if (turno && turnoTurmas[turno]) {
                // Ordenar as turmas
                const turmasOrdenadas = turnoTurmas[turno].sort((a, b) => {
                    return a.localeCompare(b, undefined, { numeric: true });
                });
                
                turmasOrdenadas.forEach(turma => {
                    const option = document.createElement('option');
                    option.value = turma;
                    option.textContent = `${turma.charAt(0)}ª Série ${turma.charAt(1)}`;
                    turmaSelectEdicao.appendChild(option);
                });
            }
        }

        // Função para popular os datalists de alunos
        function populateAlunoDatalists() {
            // Limpar os datalists
            alunosAtrasoDatalist.innerHTML = '';
            alunosCelularDatalist.innerHTML = '';
            alunosComportamentoDatalist.innerHTML = '';
            
            // Adicionar os alunos aos datalists
            alunos.forEach(aluno => {
                const option = document.createElement('option');
                option.value = `${aluno.nome} (${aluno.turma})`;
                
                alunosAtrasoDatalist.appendChild(option.cloneNode(true));
                alunosCelularDatalist.appendChild(option.cloneNode(true));
                alunosComportamentoDatalist.appendChild(option);
            });
        }

        // Função para atualizar o filtro de turmas nos relatórios
        function updateFiltroTurmas() {
            filtroTurma.innerHTML = '<option value="">Todas as turmas</option>';
            
            // Coletar todas as turmas de todos os turnos
            const todasTurmas = [];
            Object.values(turnoTurmas).forEach(turmas => {
                todasTurmas.push(...turmas);
            });
            
            // Ordenar e remover duplicatas
            const turmasUnicas = [...new Set(todasTurmas)].sort((a, b) => {
                return a.localeCompare(b, undefined, { numeric: true });
            });
            
            turmasUnicas.forEach(turma => {
                const option = document.createElement('option');
                option.value = turma;
                option.textContent = `${turma.charAt(0)}ª Série ${turma.charAt(1)}`;
                filtroTurma.appendChild(option);
            });
        }

        // Função para abrir modal de exclusão de turma
        function abrirModalExcluirTurma(turma, turno) {
            turmaParaExcluir = turma;
            turnoParaExcluir = turno;
            
            // Contar quantos alunos estão na turma
            const alunosNaTurma = alunos.filter(aluno => aluno.turma === turma && aluno.turno === turno);
            const quantidadeAlunos = alunosNaTurma.length;
            
            // Atualizar mensagem do modal
            mensagemExclusaoTurma.textContent = `Tem certeza que deseja excluir a turma ${turma.charAt(0)}ª Série ${turma.charAt(1)}?`;
            
            if (quantidadeAlunos > 0) {
                alunosAfetados.textContent = `ATENÇÃO: Esta turma possui ${quantidadeAlunos} aluno(s) cadastrado(s). Todos os alunos desta turma também serão excluídos.`;
                alunosAfetados.style.color = 'var(--vermelho)';
                alunosAfetados.style.fontWeight = 'bold';
            } else {
                alunosAfetados.textContent = 'Esta turma não possui alunos cadastrados.';
                alunosAfetados.style.color = '#666';
                alunosAfetados.style.fontWeight = 'normal';
            }
            
            modalExcluirTurma.classList.add('active');
        }

        // Função para excluir turma
        function excluirTurma() {
            if (!turmaParaExcluir || !turnoParaExcluir) return;
            
            // Remover a turma do mapeamento
            const index = turnoTurmas[turnoParaExcluir].indexOf(turmaParaExcluir);
            if (index !== -1) {
                turnoTurmas[turnoParaExcluir].splice(index, 1);
            }
            
            // Remover todos os alunos da turma
            const alunosParaManter = alunos.filter(aluno => !(aluno.turma === turmaParaExcluir && aluno.turno === turnoParaExcluir));
            alunos = alunosParaManter;
            
            // Remover registros relacionados aos alunos excluídos
            const alunosExcluidosIds = alunos.filter(aluno => aluno.turma === turmaParaExcluir && aluno.turno === turnoParaExcluir).map(aluno => aluno.id);
            
            atrasos = atrasos.filter(atraso => !alunosExcluidosIds.includes(atraso.alunoId));
            usoCelular = usoCelular.filter(celular => !alunosExcluidosIds.includes(celular.alunoId));
            comportamentos = comportamentos.filter(comportamento => !alunosExcluidosIds.includes(comportamento.alunoId));
            
            // Salvar no localStorage
            localStorage.setItem('alunos', JSON.stringify(alunos));
            localStorage.setItem('atrasos', JSON.stringify(atrasos));
            localStorage.setItem('usoCelular', JSON.stringify(usoCelular));
            localStorage.setItem('comportamentos', JSON.stringify(comportamentos));
            salvarTurmasNoLocalStorage();
            
            // Atualizar a interface
            updateTurmaOptions();
            updateFiltroTurmas();
            populateAlunoDatalists();
            updateAlunosCadastrados();
            
            // Fechar o modal
            modalExcluirTurma.classList.remove('active');
            
            // Mostrar mensagem de sucesso
            showMessage('Turma excluída com sucesso!', 'success');
            
            // Limpar variáveis
            turmaParaExcluir = null;
            turnoParaExcluir = null;
        }

        // Função para mostrar/ocultar filtros baseados no tipo de relatório
        function atualizarFiltrosRelatorio() {
            const tipo = tipoRelatorioSelect.value;
            
            // Ocultar todos os filtros
            document.querySelectorAll('.filtro-relatorio').forEach(filtro => {
                filtro.style.display = 'none';
            });
            
            // Mostrar filtro específico
            if (tipo === 'aluno') {
                filtroAlunoDiv.style.display = 'block';
            } else if (tipo === 'turma') {
                filtroTurmaRelatorioDiv.style.display = 'block';
            } else if (tipo === 'turno') {
                filtroTurnoDiv.style.display = 'block';
            }
        }

        // Função para mostrar/ocultar período personalizado
        function atualizarPeriodoRelatorio() {
            if (periodoRelatorioSelect.value === 'personalizado') {
                periodoPersonalizadoDiv.style.display = 'block';
            } else {
                periodoPersonalizadoDiv.style.display = 'none';
            }
        }

        // Função para popular dados do relatório
        function popularDadosRelatorio() {
            // Popular datalist de alunos
            const alunosRelatorioDatalist = document.getElementById('alunos-relatorio');
            alunosRelatorioDatalist.innerHTML = '';
            alunos.forEach(aluno => {
                const option = document.createElement('option');
                option.value = `${aluno.nome} (${aluno.turma})`;
                alunosRelatorioDatalist.appendChild(option);
            });
            
            // Popular select de turmas
            turmaRelatorioSelect.innerHTML = '<option value="">Todas as turmas</option>';
            const todasTurmas = [...new Set(alunos.map(aluno => aluno.turma))].sort();
            todasTurmas.forEach(turma => {
                const option = document.createElement('option');
                option.value = turma;
                option.textContent = `${turma.charAt(0)}ª Série ${turma.charAt(1)}`;
                turmaRelatorioSelect.appendChild(option);
            });
        }

        // Função para filtrar ocorrências por período
        function filtrarOcorrenciasPorPeriodo(ocorrencias, dataInicio, dataFim) {
            if (!dataInicio && !dataFim) return ocorrencias;
            
            return ocorrencias.filter(ocorrencia => {
                const dataOcorrencia = new Date(ocorrencia.data);
                let passaFiltro = true;
                
                if (dataInicio) {
                    const inicio = new Date(dataInicio);
                    passaFiltro = passaFiltro && dataOcorrencia >= inicio;
                }
                
                if (dataFim) {
                    const fim = new Date(dataFim);
                    passaFiltro = passaFiltro && dataOcorrencia <= fim;
                }
                
                return passaFiltro;
            });
        }

        // Função para gerar relatório por aluno
        function gerarRelatorioPorAluno(nomeAluno, dataInicio, dataFim) {
            const aluno = alunos.find(a => a.nome === nomeAluno);
            if (!aluno) return '<p class="sem-ocorrencias">Aluno não encontrado.</p>';
            
            let html = `
                <div class="relatorio-aluno">
                    <h4>${aluno.nome} - ${aluno.turma} (${aluno.turno})</h4>
                    <p><strong>Contato:</strong> ${formatarTelefoneParaExibir(aluno.contato)}</p>
            `;
            
            // Buscar ocorrências do aluno
            const atrasosAluno = atrasos.filter(a => a.alunoId === aluno.id);
            const celularAluno = usoCelular.filter(c => c.alunoId === aluno.id);
            const comportamentosAluno = comportamentos.filter(c => c.alunoId === aluno.id);
            
            // Filtrar por período
            const atrasosFiltrados = filtrarOcorrenciasPorPeriodo(atrasosAluno, dataInicio, dataFim);
            const celularFiltrados = filtrarOcorrenciasPorPeriodo(celularAluno, dataInicio, dataFim);
            const comportamentosFiltrados = filtrarOcorrenciasPorPeriodo(comportamentosAluno, dataInicio, dataFim);
            
            const totalOcorrencias = atrasosFiltrados.length + celularFiltrados.length + comportamentosFiltrados.length;
            
            html += `<p><strong>Total de Ocorrências:</strong> ${totalOcorrencias}</p>`;
            
            if (totalOcorrencias === 0) {
                html += '<p class="sem-ocorrencias">Nenhuma ocorrência encontrada para este período.</p>';
            } else {
                html += '<div class="ocorrencias-lista">';
                
                // Atrasos
                if (atrasosFiltrados.length > 0) {
                    html += '<h5>Atrasos:</h5>';
                    atrasosFiltrados.forEach(atraso => {
                        html += `
                            <div class="ocorrencia-item">
                                <div class="ocorrencia-tipo">Atraso</div>
                                <div class="ocorrencia-data">${atraso.data} às ${atraso.hora}</div>
                            </div>
                        `;
                    });
                }
                
                // Uso de Celular
                if (celularFiltrados.length > 0) {
                    html += '<h5>Uso de Celular:</h5>';
                    celularFiltrados.forEach(celular => {
                        html += `
                            <div class="ocorrencia-item">
                                <div class="ocorrencia-tipo">Uso de Celular</div>
                                <div class="ocorrencia-data">Aula: ${celular.aula}</div>
                                <div class="ocorrencia-detalhes">${celular.observacao || 'Sem observações'}</div>
                            </div>
                        `;
                    });
                }
                
                // Comportamentos
                if (comportamentosFiltrados.length > 0) {
                    html += '<h5>Comportamento:</h5>';
                    comportamentosFiltrados.forEach(comportamento => {
                        html += `
                            <div class="ocorrencia-item">
                                <div class="ocorrencia-tipo">Observação de Comportamento</div>
                                <div class="ocorrencia-detalhes">${comportamento.observacao}</div>
                            </div>
                        `;
                    });
                }
                
                html += '</div>';
            }
            
            html += '</div>';
            return html;
        }

        // Função para gerar relatório por turma
        function gerarRelatorioPorTurma(turmaSelecionada, dataInicio, dataFim) {
            const alunosTurma = alunos.filter(aluno => 
                turmaSelecionada ? aluno.turma === turmaSelecionada : true
            ).sort((a, b) => a.nome.localeCompare(b.nome));
            
            if (alunosTurma.length === 0) {
                return '<p class="sem-ocorrencias">Nenhum aluno encontrado para esta turma.</p>';
            }
            
            let html = `<div class="relatorio-turma">
                <h4>Relatório da Turma: ${turmaSelecionada || 'Todas as Turmas'}</h4>
                <p><strong>Total de Alunos:</strong> ${alunosTurma.length}</p>
            `;
            
            alunosTurma.forEach(aluno => {
                html += gerarRelatorioPorAluno(aluno.nome, dataInicio, dataFim);
            });
            
            html += '</div>';
            return html;
        }

        // Função para gerar relatório por turno
        function gerarRelatorioPorTurno(turnoSelecionado, dataInicio, dataFim) {
            const alunosTurno = alunos.filter(aluno => 
                turnoSelecionado ? aluno.turno === turnoSelecionado : true
            );
            
            const turmasTurno = [...new Set(alunosTurno.map(aluno => aluno.turma))].sort();
            
            let html = `<div class="relatorio-turma">
                <h4>Relatório do Turno: ${turnoSelecionado || 'Todos os Turnos'}</h4>
                <p><strong>Total de Alunos:</strong> ${alunosTurno.length}</p>
                <p><strong>Turmas:</strong> ${turmasTurno.join(', ')}</p>
            `;
            
            turmasTurno.forEach(turma => {
                html += gerarRelatorioPorTurma(turma, dataInicio, dataFim);
            });
            
            html += '</div>';
            return html;
        }

        // Função principal para gerar relatório
        function gerarRelatorioCompleto() {
            const tipo = tipoRelatorioSelect.value;
            if (!tipo) {
                showMessage('Selecione o tipo de relatório.', 'error');
                return;
            }
            
            let dataInicio = null;
            let dataFim = null;
            
            if (periodoRelatorioSelect.value === 'personalizado') {
                dataInicio = dataInicioInput.value;
                dataFim = dataFimInput.value;
                
                if (dataInicio && dataFim && new Date(dataInicio) > new Date(dataFim)) {
                    showMessage('Data de início não pode ser maior que data de fim.', 'error');
                    return;
                }
            }
            
            let conteudoHTML = '';
            
            switch (tipo) {
                case 'aluno':
                    const alunoInput = alunoRelatorioInput.value;
                    const match = alunoInput.match(/(.+)\s+\(([1-3][AB])\)/);
                    if (!match) {
                        showMessage('Selecione um aluno válido da lista.', 'error');
                        return;
                    }
                    const nomeAluno = match[1];
                    conteudoHTML = gerarRelatorioPorAluno(nomeAluno, dataInicio, dataFim);
                    break;
                    
                case 'turma':
                    const turma = turmaRelatorioSelect.value;
                    conteudoHTML = gerarRelatorioPorTurma(turma, dataInicio, dataFim);
                    break;
                    
                case 'turno':
                    const turno = turnoRelatorioSelect.value;
                    conteudoHTML = gerarRelatorioPorTurno(turno, dataInicio, dataFim);
                    break;
            }
            
            conteudoRelatorioDiv.innerHTML = conteudoHTML;
            resultadoRelatorioDiv.style.display = 'block';
            btnDownloadRelatorio.style.display = 'inline-block';
            
            showMessage('Relatório gerado com sucesso!', 'success');
        }

        // Função para fazer download do relatório em PDF
        function downloadRelatorioPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Título do relatório
            const tipo = tipoRelatorioSelect.value;
            let titulo = 'Relatório - ';
            
            switch (tipo) {
                case 'aluno':
                    titulo += alunoRelatorioInput.value;
                    break;
                case 'turma':
                    const turma = turmaRelatorioSelect.value || 'Todas as Turmas';
                    titulo += `Turma ${turma}`;
                    break;
                case 'turno':
                    const turno = turnoRelatorioSelect.value || 'Todos os Turnos';
                    titulo += `Turno ${turno}`;
                    break;
            }
            
            // Data do relatório
            const dataRelatorio = new Date().toLocaleDateString('pt-BR');
            
            doc.setFontSize(16);
            doc.text(titulo, 20, 20);
            doc.setFontSize(10);
            doc.text(`Gerado em: ${dataRelatorio}`, 20, 30);
            
            // Adicionar conteúdo (simplificado para PDF)
            let yPosition = 50;
            
            document.querySelectorAll('.relatorio-aluno').forEach(alunoDiv => {
                const nomeAluno = alunoDiv.querySelector('h4').textContent;
                const totalOcorrencias = alunoDiv.querySelector('p:nth-child(3)')?.textContent || 'Total: 0';
                
                if (yPosition > 250) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                doc.setFontSize(12);
                doc.text(nomeAluno, 20, yPosition);
                doc.setFontSize(10);
                doc.text(totalOcorrencias, 20, yPosition + 7);
                
                yPosition += 20;
                
                // Ocorrências
                alunoDiv.querySelectorAll('.ocorrencia-item').forEach(ocorrencia => {
                    if (yPosition > 270) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    const tipo = ocorrencia.querySelector('.ocorrencia-tipo').textContent;
                    const data = ocorrencia.querySelector('.ocorrencia-data')?.textContent || '';
                    const detalhes = ocorrencia.querySelector('.ocorrencia-detalhes')?.textContent || '';
                    
                    doc.text(`• ${tipo} - ${data}`, 25, yPosition);
                    if (detalhes) {
                        doc.text(`  ${detalhes}`, 25, yPosition + 5);
                        yPosition += 10;
                    }
                    yPosition += 7;
                });
                
                yPosition += 10;
            });
            
            doc.save(`relatorio_${Date.now()}.pdf`);
        }

        // Função para cadastrar aluno
        function cadastrarAluno(event) {
            event.preventDefault();
            
            const nome = document.getElementById('nome-aluno').value;
            const turno = turnoSelect.value;
            const turma = turmaSelect.value;
            let contato = document.getElementById('contato-responsavel').value;
            
            // Validar telefone
            if (!validarTelefone(contato)) {
                contatoError.style.display = 'block';
                contatoInput.focus();
                return;
            } else {
                contatoError.style.display = 'none';
            }
            
            // Formatar telefone para salvar (apenas números)
            contato = formatarTelefoneParaSalvar(contato);
            
            // Gerar ID único
            const id = Date.now().toString();
            
            // Adicionar aluno à lista
            alunos.push({
                id,
                nome,
                turno,
                turma,
                contato
            });
            
            // Salvar no localStorage
            localStorage.setItem('alunos', JSON.stringify(alunos));
            
            // Atualizar os datalists de alunos
            populateAlunoDatalists();
            
            // Limpar o formulário
            formCadastro.reset();
            
            // Resetar as opções de turma
            turmaSelect.innerHTML = '<option value="">Primeiro selecione o turno</option>';
            
            // Mostrar mensagem de sucesso
            showMessage('Aluno cadastrado com sucesso!', 'success');
        }

        // Função para registrar atraso
        function registrarAtraso(event) {
            event.preventDefault();
            
            const alunoInput = document.getElementById('aluno-atraso').value;
            const hora = document.getElementById('hora-atraso').value;
            const data = document.getElementById('data-atraso').value;
            
            // Extrair nome e turma do input
            const match = alunoInput.match(/(.+)\s+\(([1-3][AB])\)/);
            
            if (!match) {
                showMessage('Por favor, selecione um aluno válido da lista.', 'error');
                return;
            }
            
            const nomeAluno = match[1];
            const turmaAluno = match[2];
            
            // Encontrar o aluno pelo nome e turma
            const aluno = alunos.find(a => a.nome === nomeAluno && a.turma === turmaAluno);
            
            if (!aluno) {
                showMessage('Aluno não encontrado!', 'error');
                return;
            }
            
            // Adicionar atraso à lista
            atrasos.push({
                id: Date.now().toString(),
                alunoId: aluno.id,
                alunoNome: aluno.nome,
                alunoTurma: aluno.turma,
                hora,
                data
            });
            
            // Salvar no localStorage
            localStorage.setItem('atrasos', JSON.stringify(atrasos));
            
            // Limpar o formulário
            formAtrasos.reset();
            
            // Configurar data atual como padrão
            const hoje = new Date().toISOString().split('T')[0];
            document.getElementById('data-atraso').value = hoje;
            
            // Mostrar mensagem de sucesso
            showMessage('Atraso registrado com sucesso!', 'success');
        }

        // Função para registrar uso de celular
        function registrarUsoCelular(event) {
            event.preventDefault();
            
            const alunoInput = document.getElementById('aluno-celular').value;
            const aula = document.getElementById('aula-celular').value;
            const observacao = document.getElementById('observacao-celular').value;
            
            // Extrair nome e turma do input
            const match = alunoInput.match(/(.+)\s+\(([1-3][AB])\)/);
            
            if (!match) {
                showMessage('Por favor, selecione um aluno válido da lista.', 'error');
                return;
            }
            
            const nomeAluno = match[1];
            const turmaAluno = match[2];
            
            // Encontrar o aluno pelo nome e turma
            const aluno = alunos.find(a => a.nome === nomeAluno && a.turma === turmaAluno);
            
            if (!aluno) {
                showMessage('Aluno não encontrado!', 'error');
                return;
            }
            
            // Adicionar uso de celular à lista
            usoCelular.push({
                id: Date.now().toString(),
                alunoId: aluno.id,
                alunoNome: aluno.nome,
                alunoTurma: aluno.turma,
                aula,
                observacao
            });
            
            // Salvar no localStorage
            localStorage.setItem('usoCelular', JSON.stringify(usoCelular));
            
            // Limpar o formulário
            formCelular.reset();
            
            // Mostrar mensagem de sucesso
            showMessage('Uso de celular registrado com sucesso!', 'success');
        }

        // Função para registrar comportamento
        function registrarComportamento(event) {
            event.preventDefault();
            
            const alunoInput = document.getElementById('aluno-comportamento').value;
            const observacao = document.getElementById('observacao-comportamento').value;
            
            // Extrair nome e turma do input
            const match = alunoInput.match(/(.+)\s+\(([1-3][AB])\)/);
            
            if (!match) {
                showMessage('Por favor, selecione um aluno válido da lista.', 'error');
                return;
            }
            
            const nomeAluno = match[1];
            const turmaAluno = match[2];
            
            // Encontrar o aluno pelo nome e turma
            const aluno = alunos.find(a => a.nome === nomeAluno && a.turma === turmaAluno);
            
            if (!aluno) {
                showMessage('Aluno não encontrado!', 'error');
                return;
            }
            
            // Adicionar comportamento à lista
            comportamentos.push({
                id: Date.now().toString(),
                alunoId: aluno.id,
                alunoNome: aluno.nome,
                alunoTurma: aluno.turma,
                observacao
            });
            
            // Salvar no localStorage
            localStorage.setItem('comportamentos', JSON.stringify(comportamentos));
            
            // Limpar o formulário
            formComportamento.reset();
            
            // Mostrar mensagem de sucesso
            showMessage('Observação de comportamento registrada com sucesso!', 'success');
        }

        // Função para abrir modal de nova turma
        function abrirModalNovaTurma() {
            modalNovaTurma.classList.add('active');
        }

        // Função para adicionar nova turma
        function adicionarNovaTurma(event) {
            event.preventDefault();
            
            const turno = document.getElementById('nova-turma-turno').value;
            const serie = document.getElementById('nova-turma-serie').value;
            const letra = document.getElementById('nova-turma-letra').value;
            
            if (!turno || !serie || !letra) {
                showMessage('Por favor, preencha todos os campos.', 'error');
                return;
            }
            
            // Criar código da turma (ex: 1A, 2B, etc.)
            const novaTurma = serie + letra;
            
            // Verificar se a turma já existe no turno
            if (turnoTurmas[turno].includes(novaTurma)) {
                showMessage('Esta turma já existe no turno selecionado.', 'error');
                return;
            }
            
            // Adicionar a nova turma ao mapeamento
            turnoTurmas[turno].push(novaTurma);
            
            // Salvar no localStorage
            salvarTurmasNoLocalStorage();
            
            // Atualizar o select de turmas no formulário de cadastro
            updateTurmaOptions();
            
            // Atualizar o filtro de turmas nos relatórios
            updateFiltroTurmas();
            
            // Selecionar a nova turma automaticamente
            turmaSelect.value = novaTurma;
            
            // Fechar o modal
            modalNovaTurma.classList.remove('active');
            
            // Limpar o formulário
            formNovaTurma.reset();
            
            showMessage('Turma adicionada com sucesso!', 'success');
        }

        // Função para abrir o modal de edição
        function abrirModalEdicao(alunoId) {
            const aluno = alunos.find(a => a.id === alunoId);
            
            if (!aluno) {
                showMessage('Aluno não encontrado!', 'error');
                return;
            }
            
            // Preencher o formulário com os dados do aluno
            document.getElementById('editar-id').value = aluno.id;
            document.getElementById('editar-nome').value = aluno.nome;
            document.getElementById('editar-turno').value = aluno.turno;
            document.getElementById('editar-contato').value = formatarTelefoneParaExibir(aluno.contato);
            
            // Atualizar as opções de turma baseadas no turno
            updateTurmaOptionsEdicao();
            
            // Selecionar a turma correta
            setTimeout(() => {
                document.getElementById('editar-turma').value = aluno.turma;
            }, 100);
            
            // Abrir o modal
            modalEditar.classList.add('active');
        }

        // Função para editar aluno
        function editarAluno(event) {
            event.preventDefault();
            
            const id = document.getElementById('editar-id').value;
            const nome = document.getElementById('editar-nome').value;
            const turno = document.getElementById('editar-turno').value;
            const turma = document.getElementById('editar-turma').value;
            let contato = document.getElementById('editar-contato').value;
            
            // Validar telefone
            if (!validarTelefone(contato)) {
                editarContatoError.style.display = 'block';
                editarContatoInput.focus();
                return;
            } else {
                editarContatoError.style.display = 'none';
            }
            
            // Formatar telefone para salvar (apenas números)
            contato = formatarTelefoneParaSalvar(contato);
            
            // Encontrar o índice do aluno
            const alunoIndex = alunos.findIndex(a => a.id === id);
            
            if (alunoIndex === -1) {
                showMessage('Aluno não encontrado!', 'error');
                return;
            }
            
            // Atualizar os dados do aluno
            alunos[alunoIndex] = {
                id,
                nome,
                turno,
                turma,
                contato
            };
            
            // Salvar no localStorage
            localStorage.setItem('alunos', JSON.stringify(alunos));
            
            // Atualizar os datalists de alunos
            populateAlunoDatalists();
            
            // Fechar o modal
            modalEditar.classList.remove('active');
            
            // Atualizar a exibição dos alunos
            updateAlunosCadastrados();
            
            // Mostrar mensagem de sucesso
            showMessage('Aluno atualizado com sucesso!', 'success');
        }

        // Função para excluir aluno
        function excluirAluno(alunoId) {
            if (!confirm('Tem certeza que deseja excluir este aluno? Esta ação não pode ser desfeita.')) {
                return;
            }
            
            // Encontrar o índice do aluno
            const alunoIndex = alunos.findIndex(a => a.id === alunoId);
            
            if (alunoIndex === -1) {
                showMessage('Aluno não encontrado!', 'error');
                return;
            }
            
            // Remover o aluno
            alunos.splice(alunoIndex, 1);
            
            // Salvar no localStorage
            localStorage.setItem('alunos', JSON.stringify(alunos));
            
            // Atualizar os datalists de alunos
            populateAlunoDatalists();
            
            // Atualizar a exibição dos alunos
            updateAlunosCadastrados();
            
            // Mostrar mensagem de sucesso
            showMessage('Aluno excluído com sucesso!', 'success');
        }

        // Função para atualizar a seção de alunos cadastrados
        function updateAlunosCadastrados() {
            // Limpar todos os containers de turmas
            document.querySelectorAll('.turmas-grid').forEach(grid => {
                grid.innerHTML = '';
            });
            
            // Agrupar alunos por turno e turma
            const alunosPorTurnoETurma = {};
            
            alunos.forEach(aluno => {
                if (!alunosPorTurnoETurma[aluno.turno]) {
                    alunosPorTurnoETurma[aluno.turno] = {};
                }
                if (!alunosPorTurnoETurma[aluno.turno][aluno.turma]) {
                    alunosPorTurnoETurma[aluno.turno][aluno.turma] = [];
                }
                alunosPorTurnoETurma[aluno.turno][aluno.turma].push(aluno);
            });
            
            // Preencher cada turno
            Object.keys(turnoTurmas).forEach(turno => {
                const grid = document.getElementById(`grid-${turno}`);
                if (grid) {
                    // Ordenar turmas
                    const turmasOrdenadas = turnoTurmas[turno].sort((a, b) => {
                        return a.localeCompare(b, undefined, { numeric: true });
                    });
                    
                    turmasOrdenadas.forEach(turma => {
                        const alunosDaTurma = alunosPorTurnoETurma[turno]?.[turma] || [];
                        
                        // Ordenar alunos por nome (ordem alfabética)
                        const alunosOrdenados = alunosDaTurma.sort((a, b) => {
                            return a.nome.localeCompare(b.nome);
                        });
                        
                        const turmaCard = document.createElement('div');
                        turmaCard.className = 'turma-card';
                        turmaCard.id = `turma-${turma}`;
                        
                        let tabelaHTML = `
                            <div class="turma-header">
                                <h4>${turma.charAt(0)}ª Série ${turma.charAt(1)}</h4>
                                <div class="turma-actions">
                                    <button class="btn-danger btn-small" onclick="abrirModalExcluirTurma('${turma}', '${turno}')">Excluir Turma</button>
                                </div>
                            </div>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Nome</th>
                                        <th>Contato do Responsável</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody>`;
                        
                        if (alunosOrdenados.length > 0) {
                            alunosOrdenados.forEach(aluno => {
                                tabelaHTML += `
                                    <tr>
                                        <td>${aluno.nome}</td>
                                        <td>${formatarTelefoneParaExibir(aluno.contato)}</td>
                                        <td class="action-buttons">
                                            <button class="btn-secondary btn-small" onclick="abrirModalEdicao('${aluno.id}')">Editar</button>
                                            <button class="btn-danger btn-small" onclick="excluirAluno('${aluno.id}')">Excluir</button>
                                        </td>
                                    </tr>`;
                            });
                        } else {
                            tabelaHTML += `
                                <tr>
                                    <td colspan="3" style="text-align: center; color: #666;">Nenhum aluno cadastrado</td>
                                </tr>`;
                        }
                        
                        tabelaHTML += `
                                </tbody>
                            </table>`;
                        
                        turmaCard.innerHTML = tabelaHTML;
                        grid.appendChild(turmaCard);
                    });
                }
            });
        }

        // Função para atualizar os relatórios
        function updateRelatorios() {
            const turmaFiltro = filtroTurma.value;
            
            // Filtrar dados se houver filtro
            const alunosFiltrados = turmaFiltro ? 
                alunos.filter(aluno => aluno.turma === turmaFiltro) : alunos;
            
            const atrasosFiltrados = turmaFiltro ? 
                atrasos.filter(atraso => atraso.alunoTurma === turmaFiltro) : atrasos;
            
            const celularFiltrados = turmaFiltro ? 
                usoCelular.filter(celular => celular.alunoTurma === turmaFiltro) : usoCelular;
            
            const comportamentoFiltrados = turmaFiltro ? 
                comportamentos.filter(comportamento => comportamento.alunoTurma === turmaFiltro) : comportamentos;
            
            // Atualizar tabela de alunos (ordenar por nome)
            const tabelaAlunos = document.getElementById('tabela-alunos').getElementsByTagName('tbody')[0];
            tabelaAlunos.innerHTML = '';
            
            alunosFiltrados.sort((a, b) => a.nome.localeCompare(b.nome)).forEach(aluno => {
                const row = tabelaAlunos.insertRow();
                row.insertCell(0).textContent = aluno.nome;
                row.insertCell(1).textContent = aluno.turma;
                row.insertCell(2).textContent = formatarTelefoneParaExibir(aluno.contato);
            });
            
            // Atualizar tabela de atrasos
            const tabelaAtrasos = document.getElementById('tabela-atrasos').getElementsByTagName('tbody')[0];
            tabelaAtrasos.innerHTML = '';
            
            atrasosFiltrados.forEach(atraso => {
                const row = tabelaAtrasos.insertRow();
                row.insertCell(0).textContent = atraso.alunoNome;
                row.insertCell(1).textContent = atraso.alunoTurma;
                row.insertCell(2).textContent = atraso.data;
                row.insertCell(3).textContent = atraso.hora;
            });
            
            // Atualizar tabela de uso de celular
            const tabelaCelular = document.getElementById('tabela-celular').getElementsByTagName('tbody')[0];
            tabelaCelular.innerHTML = '';
            
            celularFiltrados.forEach(celular => {
                const row = tabelaCelular.insertRow();
                row.insertCell(0).textContent = celular.alunoNome;
                row.insertCell(1).textContent = celular.alunoTurma;
                row.insertCell(2).textContent = celular.aula;
                row.insertCell(3).textContent = celular.observacao;
            });
            
            // Atualizar tabela de comportamento
            const tabelaComportamento = document.getElementById('tabela-comportamento').getElementsByTagName('tbody')[0];
            tabelaComportamento.innerHTML = '';
            
            comportamentoFiltrados.forEach(comportamento => {
                const row = tabelaComportamento.insertRow();
                row.insertCell(0).textContent = comportamento.alunoNome;
                row.insertCell(1).textContent = comportamento.alunoTurma;
                row.insertCell(2).textContent = comportamento.observacao;
            });
        }

        // Função para alternar entre abas de turno
        function switchTurnoTab(turno) {
            // Atualizar abas
            turnoTabs.forEach(tab => {
                if (tab.getAttribute('data-turno') === turno) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
            
            // Atualizar conteúdos
            turnoContents.forEach(content => {
                if (content.id === `turno-${turno}`) {
                    content.classList.add('active');
                } else {
                    content.classList.remove('active');
                }
            });
        }

        // Função para melhorar a experiência mobile
        function setupMobileOptimizations() {
            // Prevenir zoom duplo em inputs no iOS
            document.addEventListener('touchstart', function() {}, {passive: true});
            
            // Melhorar o fechamento do teclado virtual
            document.addEventListener('focusout', function() {
                setTimeout(() => {
                    window.scrollTo(0, 0);
                }, 100);
            });
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            setupMobileOptimizations();
            
            // Popular os datalists de alunos
            populateAlunoDatalists();
            
            // Configurar navegação
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const target = this.getAttribute('data-target');
                    navigateToSection(target);
                });
            });
            
            // Configurar formulários
            formCadastro.addEventListener('submit', cadastrarAluno);
            formAtrasos.addEventListener('submit', registrarAtraso);
            formCelular.addEventListener('submit', registrarUsoCelular);
            formComportamento.addEventListener('submit', registrarComportamento);
            formEditarAluno.addEventListener('submit', editarAluno);
            formNovaTurma.addEventListener('submit', adicionarNovaTurma);
            
            // Configurar máscara de telefone
            contatoInput.addEventListener('input', function(e) {
                const valor = e.target.value;
                const selecaoInicio = e.target.selectionStart;
                const selecaoFim = e.target.selectionEnd;
                
                // Aplicar máscara
                e.target.value = mascaraTelefone(valor);
                
                // Manter a posição do cursor
                if (selecaoInicio === selecaoFim) {
                    e.target.setSelectionRange(selecaoInicio, selecaoFim);
                }
                
                // Validar telefone
                if (!validarTelefone(valor)) {
                    contatoError.style.display = 'block';
                } else {
                    contatoError.style.display = 'none';
                }
            });
            
            editarContatoInput.addEventListener('input', function(e) {
                const valor = e.target.value;
                const selecaoInicio = e.target.selectionStart;
                const selecaoFim = e.target.selectionEnd;
                
                // Aplicar máscara
                e.target.value = mascaraTelefone(valor);
                
                // Manter a posição do cursor
                if (selecaoInicio === selecaoFim) {
                    e.target.setSelectionRange(selecaoInicio, selecaoFim);
                }
                
                // Validar telefone
                if (!validarTelefone(valor)) {
                    editarContatoError.style.display = 'block';
                } else {
                    editarContatoError.style.display = 'none';
                }
            });
            
            // Configurar select de turno
            turnoSelect.addEventListener('change', updateTurmaOptions);
            document.getElementById('editar-turno').addEventListener('change', updateTurmaOptionsEdicao);
            
            // Configurar botão de gerar relatório
            btnGerarRelatorio.addEventListener('click', updateRelatorios);
            
            // Configurar abas de turno
            turnoTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const turno = this.getAttribute('data-turno');
                    switchTurnoTab(turno);
                });
            });
            
            // Configurar modal de edição
            btnCancelarEdicao.addEventListener('click', () => {
                modalEditar.classList.remove('active');
            });
            
            closeModal.addEventListener('click', () => {
                modalEditar.classList.remove('active');
            });
            
            // Fechar modal ao clicar fora dele
            modalEditar.addEventListener('click', (e) => {
                if (e.target === modalEditar) {
                    modalEditar.classList.remove('active');
                }
            });
            
            // Configurar modal de nova turma
            btnNovaTurma.addEventListener('click', abrirModalNovaTurma);
            btnCancelarTurma.addEventListener('click', () => {
                modalNovaTurma.classList.remove('active');
            });
            
            // Fechar modal de turma ao clicar fora
            modalNovaTurma.addEventListener('click', (e) => {
                if (e.target === modalNovaTurma) {
                    modalNovaTurma.classList.remove('active');
                }
            });
            
            // Configurar modal de exclusão de turma
            btnCancelarExclusaoTurma.addEventListener('click', () => {
                modalExcluirTurma.classList.remove('active');
                turmaParaExcluir = null;
                turnoParaExcluir = null;
            });
            
            btnConfirmarExclusaoTurma.addEventListener('click', excluirTurma);
            
            // Fechar modal de exclusão ao clicar fora
            modalExcluirTurma.addEventListener('click', (e) => {
                if (e.target === modalExcluirTurma) {
                    modalExcluirTurma.classList.remove('active');
                    turmaParaExcluir = null;
                    turnoParaExcluir = null;
                }
            });

            // Configurar relatórios avançados
            tipoRelatorioSelect.addEventListener('change', atualizarFiltrosRelatorio);
            periodoRelatorioSelect.addEventListener('change', atualizarPeriodoRelatorio);
            btnGerarRelatorioCompleto.addEventListener('click', gerarRelatorioCompleto);
            btnDownloadRelatorio.addEventListener('click', downloadRelatorioPDF);

            // Popular dados do relatório
            popularDadosRelatorio();

            // Configurar datas padrão
            const hoje = new Date();
            const umaSemanaAtras = new Date(hoje);
            umaSemanaAtras.setDate(hoje.getDate() - 7);

            dataInicioInput.value = umaSemanaAtras.toISOString().split('T')[0];
            dataFimInput.value = hoje.toISOString().split('T')[0];
            
            // Configurar data atual como padrão para o campo de data de atraso
            document.getElementById('data-atraso').value = hoje.toISOString().split('T')[0];
            
            // Inicializar a seção de alunos cadastrados se necessário
            if (alunos.length > 0) {
                updateAlunosCadastrados();
            }
            
            // Atualizar o filtro de turmas
            updateFiltroTurmas();
        });
    </script>
</body>
</html>
